## mysql锁机制
---
> 参考马士兵mysql调优相关文档，及其余网页链接

---

- 主要的锁机制
  - **表级锁:** 开销小，加锁快; 不会出现死锁；锁定力度大，发生锁冲突的概率最高，并发度最低。
  - **行级锁:** 开销大，加锁慢; 会出现死锁；锁定力度小，发生锁冲突的概率最低，并发度也最高。

---

- MyISAM存储引擎
  - myisam使用的是**表锁**
  - 表锁实现
    - 表共享读锁(Table Read Lock):不会阻塞其他用户对同一表的读请求，但会阻塞对同一表的写请求
    - 表独占写锁(Table Write Lock):会阻塞其他用户对同一表的读和写操作
    - 同时，myisam表的读操作与写操作之间、以及写操作之间，是串行的。
  - 具体说明
    - 写锁阻塞读: session a 使用 lock table tablename write; 加上写锁。session a 依然可以对该表进行查询、更新操作；session b 对该表的所有操作都会被阻塞。
    - 读锁阻塞写:session a 使用 lock table tablename read; 加上读锁。session a只能读取当前表数据，不可读取其他表、更新当前表、更新其他表；session b 允许对该表的查询权限，更新、插入无权限，对其他未锁定的表无限制。
  - **注意:** 
    - myisam执行语句前，会自动给涉及的表加对应读锁或者写锁，无需显式加锁。
    - 可使用 **show status like 'table%'**命令查看以下两个状态，来确定表锁的竞争状态
      - Table_locks_immediate:能够立即获得表级锁的请求次数
      - Table_locks_waited:不能立即获得表级锁、需要等待锁请求的次数。**该值越大，锁竞争越激烈**